<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fish Incremental Game</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    text-align: center; 
    margin-top: 20px; 
    background-color: #001f3f; 
    color: white; 
  }
  .fish-btn { 
    width: 64px; 
    height: 64px; 
    display: inline-block; 
    margin: 6px; 
    cursor: pointer; 
    position: relative;
  }
  .equipped { border: 3px solid gold; }
  .tooltip { position: relative; display: inline-block; }
  .tooltip .tiptext {
    visibility: hidden;
    width: 200px;
    background-color: black;
    color: #fff;
    text-align: center;
    padding: 2px 5px;
    border-radius: 4px;
    position: absolute;
    z-index: 1;
    bottom: 60%;
    left: 50%;
    margin-left: -100px;
    font-size: 12px;
    white-space: pre-line;
  }
  .tooltip:hover .tiptext { visibility: visible; }
  .tabs { margin-top: 20px; }
  .tab-button { padding: 5px 10px; margin: 0 5px; cursor: pointer; }
  .active-tab { background-color: #ddd; color: black; }
  .tab-content { display: none; margin-top: 20px; }
  .tab-content.active { display: block; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  #fishingLog { max-height: 150px; overflow-y: auto; background: #002a5f; padding: 5px; margin-top: 10px; border-radius: 5px; text-align:left; font-size:14px; }
</style>
</head>
<body>

<h1>Fish Incremental Game</h1>

<div class="tabs">
  <button class="tab-button active-tab" onclick="showTab('game')">Game</button>
  <button class="tab-button" onclick="showTab('inventory')">Inventory</button>
  <button class="tab-button" onclick="showTab('fishing')">Fishing</button>
</div>

<!-- Game Tab -->
<div id="game" class="tab-content active">
  <p id="fishFood">Fish Food: 50</p>
  <p id="money">Money: $0</p>
  <p id="equippedFishStats">Equipped Fish: None</p>
  <p id="totalFishCount">Total Fish: 5</p>

  <button id="feedBtn" onclick="feedFish()">Feed Equipped Fish</button>
  <button id="sellBtn" onclick="sellFish()">Sell Equipped Fish</button>
  <button onclick="buyFood()">Buy 10 Fish Food ($5)</button>
  <button onclick="buyFish()">Buy 1 Fish ($20)</button>

  <br><br>
  <button id="moneyUpgradeBtn" onclick="buyMoneyUpgrade()">Upgrade Money Gain</button>
  <p id="moneyUpgradeInfo">Next upgrade: $10, x1.2 multiplier</p>
</div>

<!-- Inventory Tab -->
<div id="inventory" class="tab-content">
  <p id="fishCountDisplay"></p>
  <div id="inventoryGrid"></div>
  <br>
  <button onclick="upgradeMaxInventory()">Upgrade Max Inventory</button>
  <p id="maxInventoryInfo"></p>
</div>

<!-- Fishing Tab -->
<div id="fishing" class="tab-content">
  <p>Fishing Chances:</p>
  <ul>
    <li id="chanceNothing"></li>
    <li id="chanceBasic"></li>
    <li id="chanceClown"></li>
  </ul>
  <button id="fishBtn" onclick="fishCatch()" style="padding:10px 20px;">Fish</button>
  <p id="fishingCooldown">Cooldown: 0s</p>
  <button onclick="upgradeLuck()">Upgrade Luck</button>
  <p id="luckInfo"></p>
  <button onclick="upgradeCooldown()">Upgrade Cooldown</button>
  <p id="cooldownInfo"></p>
  <div id="fishingLog"></div>
</div>

<script>
const maxFishSizeDefault = 10;
const maxClownfishSize = 15;
const maxClownfishBaseWorth = 20;

let money = 0;
let fishFood = 50;
let inventory = [];
let equippedFishIndex = null;

// Game upgrades
let moneyMultiplier = 1;
let moneyUpgradeCost = 10;

// Fishing upgrades
let luckLevel = 0;
let luckCost = 10;
let cooldownLevel = 0;
let cooldownCost = 5;
let fishingCooldownMax = 5;
let fishingCooldown = 0;
let fishingInterval;

// Inventory upgrades
let maxFishCount = 10;
let inventoryUpgradeLevel = 0;
let inventoryUpgradeCost = 20;

// Fish qualities
const qualities = [
  { name: "Perfect", multiplier: 8, chance: 1, color: "cyan" },
  { name: "Bad", multiplier: 0.5, chance: 20, color: "#555" },
  { name: "Okay", multiplier: 1, chance: 65, color: "#ccc" },
  { name: "Good", multiplier: 2, chance: 14, color: "gold" }
];

// Helper: roll fish quality
function rollQuality() {
  const roll = Math.random() * 100;
  let cumulative = 0;
  for (const q of qualities) {
    cumulative += q.chance;
    if (roll < cumulative) return q;
  }
  return qualities[2]; // default Okay
}

// Determine species
function determineSpecies() {
  return Math.random() < 1/3 ? "Clownfish" : "Basic Fish";
}

// Initialize 5 Okay Basic/Clownfish
for (let i = 0; i < 5; i++) {
  const species = determineSpecies();
  inventory.push({ name: species, size: 1, quality: { name: "Okay", multiplier: 1, color: "#ccc" } });
}

// UI Functions
function showTab(tabName) {
  document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
  document.getElementById(tabName).classList.add('active');
  document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active-tab'));
  document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active-tab');
  updateUI();
}

function updateUI() {
  document.getElementById('fishFood').textContent = `Fish Food: ${fishFood}`;
  document.getElementById('money').textContent = `Money: $${money}`;

  const equippedText = equippedFishIndex === null
    ? "Equipped Fish: None"
    : `${inventory[equippedFishIndex].quality.name} ${inventory[equippedFishIndex].name} (Size: ${inventory[equippedFishIndex].size}/${inventory[equippedFishIndex].name==="Clownfish"?maxClownfishSize:maxFishSizeDefault})`;
  document.getElementById('equippedFishStats').textContent = equippedText;

  document.getElementById('totalFishCount').textContent = `Total Fish: ${inventory.length}`;

  document.getElementById('feedBtn').style.display = equippedFishIndex === null ? 'none' : 'inline-block';
  document.getElementById('sellBtn').style.display = equippedFishIndex === null ? 'none' : 'inline-block';
  document.getElementById('moneyUpgradeInfo').textContent = `Next upgrade: $${moneyUpgradeCost}, x1.2 multiplier`;

  // Inventory tab
  document.getElementById('fishCountDisplay').textContent = `Fish owned: ${inventory.length}/${maxFishCount}`;
  document.getElementById('maxInventoryInfo').textContent = `Next upgrade: $${inventoryUpgradeCost}, +5 fish per level`;

  // Generate inventory grid
  const inventoryGrid = document.getElementById('inventoryGrid');
  inventoryGrid.innerHTML = '';
  inventory.forEach((fish, index) => {
    const fishDiv = document.createElement('div');
    fishDiv.className = 'fish-btn tooltip';
    fishDiv.style.backgroundColor = fish.quality.color;
    if (index === equippedFishIndex) fishDiv.classList.add('equipped');

    const fishImg = document.createElement('img');
    fishImg.src = fish.name === "Clownfish" ? 'images/clownfish_4x.png' : 'images/basic_fish_4x.png';
    fishImg.width = 64;
    fishImg.height = 64;
    fishDiv.appendChild(fishImg);

    const tip = document.createElement('span');
    tip.className = 'tiptext';
    const maxSize = fish.name === "Clownfish" ? maxClownfishSize : maxFishSizeDefault;
    tip.textContent = `${fish.quality.name} ${fish.name}\nSize: ${fish.size}/${maxSize}`;
    fishDiv.appendChild(tip);

    fishDiv.onclick = () => { equippedFishIndex = index; updateUI(); showTab('game'); };
    inventoryGrid.appendChild(fishDiv);
  });

  // Fishing tab
  const chanceNothing = Math.max(0, 65 - luckLevel*5);
  const chanceClown = 10 + Math.floor(luckLevel*1.5);
  const chanceBasic = 100 - chanceNothing - chanceClown;
  document.getElementById('chanceNothing').textContent = `Nothing: ${chanceNothing}%`;
  document.getElementById('chanceBasic').textContent = `Basic Fish: ${chanceBasic}%`;
  document.getElementById('chanceClown').textContent = `Clownfish: ${chanceClown}%`;
  document.getElementById('luckInfo').textContent = `Luck Level: ${luckLevel} (Next upgrade: $${luckCost})`;
  document.getElementById('cooldownInfo').textContent = `Cooldown Level: ${cooldownLevel} (Next upgrade: $${cooldownCost})`;
}

// Game functions
function feedFish() {
  if (equippedFishIndex === null) return;
  const fish = inventory[equippedFishIndex];
  const maxSize = fish.name === "Clownfish" ? maxClownfishSize : maxFishSizeDefault;
  if (fish.size >= maxSize) return;
  if (fishFood > 0) { fishFood--; fish.size++; updateUI(); }
}

function sellFish() {
  if (equippedFishIndex === null) return;
  const fish = inventory[equippedFishIndex];
  const maxSize = fish.name === "Clownfish" ? maxClownfishSize : maxFishSizeDefault;
  const baseValue = fish.name === "Clownfish" ? Math.floor(fish.size / maxSize * maxClownfishBaseWorth) : (fish.size >= maxSize ? 10 : Math.floor(fish.size));
  money += Math.floor(baseValue * fish.quality.multiplier * moneyMultiplier);
  inventory.splice(equippedFishIndex,1);
  equippedFishIndex = null;
  updateUI();
}

function buyFood() { if (money>=5){ money-=5; fishFood+=10; updateUI(); } }
function buyFish() { if (inventory.length>=maxFishCount) return; if(money>=20){ money-=20; inventory.push({name:determineSpecies(),size:1,quality:rollQuality()}); updateUI(); } }
function buyMoneyUpgrade(){ if(money>=moneyUpgradeCost){ money-=moneyUpgradeCost; moneyMultiplier*=1.2; moneyUpgradeCost=Math.round(moneyUpgradeCost*2); updateUI(); } }

// Fishing functions
function fishCatch(){
  if(fishingCooldown>0) return;
  if(inventory.length>=maxFishCount){ logFishing("Inventory full!"); return; }

  const roll=Math.random()*100;
  const chanceNothing=Math.max(0,65-luckLevel*5);
  const chanceClown=10+Math.floor(luckLevel*1.5);
  const chanceBasic=100-chanceNothing-chanceClown;

  let caughtFish=null;
  if(roll<chanceNothing){ logFishing("You caught nothing!"); }
  else if(roll<chanceNothing+chanceBasic){ caughtFish={name:"Basic Fish",size:1,quality:rollQuality()}; }
  else{ caughtFish={name:"Clownfish",size:1,quality:rollQuality()}; }

  if(caughtFish){ inventory.push(caughtFish); logFishing(`You caught a ${caughtFish.quality.name} ${caughtFish.name}!`); }

  fishingCooldown=Math.max(1,fishingCooldownMax-cooldownLevel);
  updateFishingCooldown();
  if(!fishingInterval) fishingInterval=setInterval(updateFishingCooldown,1000);
  updateUI();
}

function updateFishingCooldown(){
  const btn=document.getElementById('fishBtn');
  if(fishingCooldown>0){ document.getElementById('fishingCooldown').textContent=`Cooldown: ${fishingCooldown}s`; btn.disabled=true; fishingCooldown--; }
  else{ document.getElementById('fishingCooldown').textContent="Cooldown: 0s"; btn.disabled=false; clearInterval(fishingInterval); fishingInterval=null; }
}

function logFishing(msg){ const log=document.getElementById('fishingLog'); const p=document.createElement('p'); p.textContent=msg; log.appendChild(p); log.scrollTop=log.scrollHeight; }

// Upgrades
function upgradeLuck(){ if(money>=luckCost){ money-=luckCost; luckLevel++; luckCost=Math.round(luckCost*1.2); updateUI(); } }
function upgradeCooldown(){ if(money>=cooldownCost){ money-=cooldownCost; cooldownLevel++; cooldownCost=Math.round(cooldownCost*3); updateUI(); } }
function upgradeMaxInventory(){ if(money>=inventoryUpgradeCost){ money-=inventoryUpgradeCost; inventoryUpgradeLevel++; maxFishCount+=5; inventoryUpgradeCost=Math.round(inventoryUpgradeCost*2); updateUI(); } }

updateUI();
</script>
</body>
</html>
