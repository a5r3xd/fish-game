<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>The Fish Game</title>
<style>
  body { 
    font-family: Arial, sans-serif; 
    text-align: center; 
    margin-top: 20px; 
    background-color: #001f3f; 
    color: white; 
  }
  .fish-btn { 
    width: 64px; 
    height: 64px; 
    display: inline-block; 
    margin: 6px; 
    cursor: pointer; 
    position: relative;
  }
  .equipped { border: 3px solid gold; }
  .tooltip { position: relative; display: inline-block; }
  .tooltip .tiptext {
    visibility: hidden;
    width: 200px;
    background-color: black;
    color: #fff;
    text-align: center;
    padding: 2px 5px;
    border-radius: 4px;
    position: absolute;
    z-index: 1;
    bottom: 60%;
    left: 50%;
    margin-left: -100px;
    font-size: 12px;
    white-space: pre-line;
  }
  .tooltip:hover .tiptext { visibility: visible; }
  .tabs { margin-top: 20px; }
  .tab-button { padding: 5px 10px; margin: 0 5px; cursor: pointer; }
  .active-tab { background-color: #ddd; color: black; }
  .tab-content { display: none; margin-top: 20px; }
  .tab-content.active { display: block; }
  button:disabled { opacity: 0.5; cursor: not-allowed; }
  #fishingLog { max-height: 150px; overflow-y: auto; background: #002a5f; padding: 5px; margin-top: 10px; border-radius: 5px; text-align:left; font-size:14px; }
</style>
</head>
<body>

<h1>The Fish Game</h1>

<div class="tabs">
  <button class="tab-button active-tab" onclick="showTab('game')">Game</button>
  <button class="tab-button" onclick="showTab('inventory')">Inventory</button>
  <button class="tab-button" onclick="showTab('fishing')">Fishing</button>
</div>

<!-- Game Tab -->
<div id="game" class="tab-content active">
  <p id="fishFood">Fish Food: 50</p>
  <p id="money">Money: $0</p>
  <p id="equippedFishStats">Equipped Fish: None</p>
  <p id="totalFishCount">Total Fish: 5</p>

  <button id="feedBtn" onclick="feedFish()">Feed Equipped Fish</button>
  <button id="sellBtn" onclick="sellFish()">Sell Equipped Fish</button>
  <button onclick="buyFood()">Buy 10 Fish Food ($5)</button>
  <button onclick="buyFish()">Buy 1 Fish ($20)</button>

  <br><br>
  <button id="moneyUpgradeBtn" onclick="buyMoneyUpgrade()">Upgrade Money Gain</button>
  <p id="moneyUpgradeInfo">Next upgrade: $10, x1.2 multiplier</p>
</div>

<!-- Inventory Tab -->
<div id="inventory" class="tab-content">
  <p id="fishCountDisplay"></p>
  <div id="inventoryGrid"></div>
  <br>
  <button onclick="upgradeMaxInventory()">Upgrade Max Inventory</button>
  <p id="maxInventoryInfo"></p>
</div>

<!-- Fishing Tab -->
<div id="fishing" class="tab-content">
  <p>Fishing Species Chances:</p>
  <ul id="speciesChancesList"></ul>
  <p id="qualityLuckInfo"></p>
  <button id="fishBtn" onclick="fishCatch()" style="padding:10px 20px;">Fish</button>
  <p id="fishingCooldown">Cooldown: 0s</p>
  <button onclick="upgradeLuck()">Upgrade Luck</button>
  <p id="luckInfo"></p>
  <button onclick="upgradeCooldown()">Upgrade Cooldown</button>
  <p id="cooldownInfo"></p>
  <button onclick="upgradeQualityLuck()">Upgrade Quality Luck</button>
  <div id="fishingLog"></div>
</div>

<script>
const maxFishSizeDefault = 10;
const maxClownfishSize = 15;
const maxClownfishBaseWorth = 20;
const leechMaxSize = 18;
const leechBaseWorth = 50;

let money = 0;
let fishFood = 50;
let inventory = [];
let equippedFishIndex = null;

let moneyMultiplier = 1;
let moneyUpgradeCost = 10;

let luckLevel = 0;
let luckCost = 10;
let cooldownLevel = 0;
let cooldownCost = 5;
let fishingCooldownMax = 5;
let fishingCooldown = 0;
let fishingInterval = null;

let maxFishCount = 10;
let inventoryUpgradeLevel = 0;
let inventoryUpgradeCost = 20;

let qualityLuckLevel = 0;
let qualityLuckCost = 20;

const qualities = [
    { name: "Bad", base: 20, multiplier:0.5, color:"#555" },
    { name: "Okay", base: 65, multiplier:1, color:"#ccc" },
    { name: "Good", base: 14, multiplier:2, color:"gold" },
    { name: "Perfect", base: 1, multiplier:8, color:"cyan" }
];

const speciesList = [
    { name: "Nothing", base: 65 },
    { name: "Basic Fish", base: 25, maxSize: maxFishSizeDefault, baseWorth:10 },
    { name: "Clownfish", base: 10, maxSize: maxClownfishSize, baseWorth: maxClownfishBaseWorth },
    { name: "Leech", base: 2, maxSize: leechMaxSize, baseWorth: leechBaseWorth }
];

// Initialize 5 Okay Basic/Clownfish
for(let i=0;i<5;i++){
    const species = Math.random() < 1/3 ? "Clownfish" : "Basic Fish";
    inventory.push({ name: species, size:1, quality:{...qualities[1]} });
}

function getMaxWorth(fish){ 
  const s = speciesList.find(sp=>sp.name===fish.name);
  return Math.floor(s.baseWorth * fish.quality.multiplier * moneyMultiplier);
}

function showTab(tab){ 
  document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
  document.getElementById(tab).classList.add('active');
  document.querySelectorAll('.tab-button').forEach(btn=>btn.classList.remove('active-tab'));
  document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active-tab');
  updateUI(); 
}

function updateUI(){
    document.getElementById('fishFood').textContent = `Fish Food: ${fishFood}`;
    document.getElementById('money').textContent = `Money: $${money}`;
    document.getElementById('equippedFishStats').textContent = equippedFishIndex===null?"Equipped Fish: None":`${inventory[equippedFishIndex].quality.name} ${inventory[equippedFishIndex].name} (Size: ${inventory[equippedFishIndex].size}/${speciesList.find(sp=>sp.name===inventory[equippedFishIndex].name).maxSize})`;
    document.getElementById('totalFishCount').textContent = `Total Fish: ${inventory.length}`;
    document.getElementById('feedBtn').style.display = equippedFishIndex===null?'none':'inline-block';
    document.getElementById('sellBtn').style.display = equippedFishIndex===null?'none':'inline-block';
    document.getElementById('moneyUpgradeInfo').textContent=`Next upgrade: $${moneyUpgradeCost}, x1.2 multiplier`;
    document.getElementById('fishCountDisplay').textContent=`Fish owned: ${inventory.length}/${maxFishCount}`;
    document.getElementById('maxInventoryInfo').textContent=`Next upgrade: $${inventoryUpgradeCost}, +5 fish per level`;

    const grid=document.getElementById('inventoryGrid'); grid.innerHTML='';
    inventory.forEach((f,i)=>{
        const div=document.createElement('div'); div.className='fish-btn tooltip';
        div.style.backgroundColor=f.quality.color; if(i===equippedFishIndex) div.classList.add('equipped');
        const img=document.createElement('img'); img.src=f.name==="Clownfish"?'images/clownfish_4x.png':f.name==="Leech"?'images/leech_4x.png':'images/basic_fish_4x.png'; img.width=64; img.height=64;
        div.appendChild(img);
        const tip=document.createElement('span'); tip.className='tiptext';
        const max=speciesList.find(sp=>sp.name===f.name).maxSize;
        tip.textContent=`${f.quality.name} ${f.name}\nSize: ${f.size}/${max}\nMax Worth: $${getMaxWorth(f)}`;
        div.appendChild(tip);
        div.onclick=()=>{ equippedFishIndex=i; updateUI(); showTab('game'); };
        grid.appendChild(div);
    });

    // Dynamic species chances
    const dynSpecies = getDynamicSpeciesChances();
    const list = document.getElementById('speciesChancesList'); list.innerHTML='';
    dynSpecies.forEach(s=>{
        const li=document.createElement('li'); li.textContent=`${s.name}: ${s.chance}%`; list.appendChild(li);
    });

    // Dynamic quality chances
    const qChances = getDynamicQualityChances();
    document.getElementById('qualityLuckInfo').textContent=`Quality Luck Level: ${qualityLuckLevel} (Next upgrade: $${qualityLuckCost})\n${qChances.map(q=>q.name+': '+q.chance+'%').join(', ')}`;

    document.getElementById('luckInfo').textContent=`Luck Level: ${luckLevel} (Next upgrade: $${luckCost})`;
    document.getElementById('cooldownInfo').textContent=`Cooldown Level: ${cooldownLevel} (Next upgrade: $${cooldownCost})`;
}

// Feed/Sell/Buy
function feedFish(){ if(equippedFishIndex===null) return; const f=inventory[equippedFishIndex]; const max=speciesList.find(sp=>sp.name===f.name).maxSize; if(f.size<max&&fishFood>0){ f.size++; fishFood--; updateUI(); } }
function sellFish(){ if(equippedFishIndex===null) return; const f=inventory[equippedFishIndex]; const max=speciesList.find(sp=>sp.name===f.name).maxSize; const base=speciesList.find(sp=>sp.name===f.name).baseWorth; money+=Math.floor(base*f.quality.multiplier*moneyMultiplier); inventory.splice(equippedFishIndex,1); equippedFishIndex=null; updateUI(); }
function buyFood(){ if(money>=5){ money-=5; fishFood+=10; updateUI(); } }
function buyFish(){ if(inventory.length>=maxFishCount) return; if(money>=20){ money-=20; let speciesRoll=Math.random(), species; if(speciesRoll<1/3){ species = Math.random()<0.2?"Leech":"Clownfish"; } else species="Basic Fish"; inventory.push({name:species,size:1,quality:rollQuality()}); updateUI(); } }
function buyMoneyUpgrade(){ if(money>=moneyUpgradeCost){ money-=moneyUpgradeCost; moneyMultiplier*=1.2; moneyUpgradeCost=Math.round(moneyUpgradeCost*2); updateUI(); } }

// Upgrades
function upgradeLuck(){ if(money>=luckCost){ money-=luckCost; luckLevel++; luckCost=Math.round(luckCost*1.2); updateUI(); } }
function upgradeCooldown(){ if(cooldownLevel>=4) return; if(money>=cooldownCost){ money-=cooldownCost; cooldownLevel++; cooldownCost=Math.round(cooldownCost*3); updateUI(); } }
function upgradeQualityLuck(){ if(money>=qualityLuckCost){ money-=qualityLuckCost; qualityLuckLevel++; qualityLuckCost=Math.round(qualityLuckCost*1.2); updateUI(); } }
function upgradeMaxInventory(){ if(money>=inventoryUpgradeCost){ money-=inventoryUpgradeCost; inventoryUpgradeLevel++; maxFishCount+=5; inventoryUpgradeCost=Math.round(inventoryUpgradeCost*2); updateUI(); } }

// Fishing
let fishingLog=document.getElementById('fishingLog');
function fishCatch(){
  if(fishingCooldown>0) return;
  if(inventory.length>=maxFishCount){ logFishing("Inventory full!"); return; }

  const dynSpecies = getDynamicSpeciesChances();
  let roll=Math.random()*100;
  let total=0; let caught=null;
  for(let s of dynSpecies){
      total+=parseFloat(s.chance);
      if(roll<total){
          if(s.name!=="Nothing") caught={name:s.name,size:1,quality:rollQuality()};
          else { logFishing("You caught nothing!"); return; }
          break;
      }
  }
  if(caught){ inventory.push(caught); logFishing(`You caught a ${caught.quality.name} ${caught.name}!`); }

  fishingCooldown=Math.max(1,fishingCooldownMax-cooldownLevel);
  updateFishingCooldown();
  if(!fishingInterval) fishingInterval=setInterval(updateFishingCooldown,1000);

  updateUI();
}
function updateFishingCooldown(){ const btn=document.getElementById('fishBtn'); if(fishingCooldown>0){ document.getElementById('fishingCooldown').textContent=`Cooldown: ${fishingCooldown}s`; btn.disabled=true; fishingCooldown--; } else { document.getElementById('fishingCooldown').textContent="Cooldown: 0s"; btn.disabled=false; clearInterval(fishingInterval); fishingInterval=null; } }
function logFishing(msg){ const p=document.createElement('p'); p.textContent=msg; fishingLog.appendChild(p); fishingLog.scrollTop=fishingLog.scrollHeight; }

// Dynamic cascading functions
function getDynamicSpeciesChances(){
    let arr = speciesList.map(s=>({...s}));
    for(let i=0;i<arr.length-1;i++){
        let reduction = i===0?luckLevel*5: luckLevel*1.2;
        arr[i].base = Math.max(0, arr[i].base-reduction);
        arr[i+1].base += reduction; // spillover
    }
    const total = arr.reduce((sum,s)=>sum+s.base,0);
    return arr.map(s=>({name:s.name, chance:Math.min(100, Math.max(0, s.base/total*100))}));
}

function getDynamicQualityChances(){
    let arr = qualities.map(q=>({...q}));
    for(let i=0;i<arr.length-1;i++){
        let reduction = qualityLuckLevel*2;
        arr[i].base = Math.max(0, arr[i].base-reduction);
        arr[i+1].base += reduction;
    }
    const total = arr.reduce((sum,q)=>sum+q.base,0);
    return arr.map(q=>({name:q.name,chance:Math.min(100,Math.max(0,Math.round(q.base/total*100)))}));
}

function rollQuality(){
    const qChances=getDynamicQualityChances();
    let roll=Math.random()*100;
    let cum=0;
    for(let q of qChances){
        cum+=parseFloat(q.chance);
        if(roll<cum) return {...qualities.find(x=>x.name===q.name)};
    }
    return {...qualities.find(x=>x.name==="Okay")};
}

updateUI();
</script>
</body>
</html>
